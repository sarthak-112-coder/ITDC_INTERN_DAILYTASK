using System;
using System.Collections.Generic;
using System.Text;

namespace Password_Manager
{
    class Password
    {
        // Here String is used to validate password 
        private bool ContainsUpper(string s) => s != s.ToLower();

        private bool ContainsLower(string s) => s != s.ToUpper();

        private bool ContainsDigit(string s)
        {
            foreach (char c in s)
            {
                if (char.IsDigit(c))
                    return true;
            }
            return false;
        }

        private bool ContainsSpecial(string s)
        {
            string special = "!@#$%^&*()_+-=?";
            foreach (char c in s)
            {
                if (special.Contains(c))
                    return true;
            }
            return false;
        }

        private bool ContainsRepeat(string s)
        {
            HashSet<char> set = new HashSet<char>();
            foreach (char c in s)
            {
                if (set.Contains(c))
                    return true;

                set.Add(c);
            }
            return false;
        }

        protected void PasswordAnalyzer()
        {
            int score = 0;
            List<string> issues = new List<string>();

            Console.Write("Enter Password: ");
            string pwd = Console.ReadLine();

            // Password Length 
            if (pwd.Length >= 8)
                score++;
            else
                issues.Add("Password length < 8");

            // Uppercase 
            if (ContainsUpper(pwd))
                score++;
            else
                issues.Add("No uppercase letter");

            // Lowercase 
            if (ContainsLower(pwd))
                score++;
            else
                issues.Add("No lowercase letter");

            // Digits 
            if (ContainsDigit(pwd))
                score++;
            else
                issues.Add("No numbers in password");

            // Special characters
            if (ContainsSpecial(pwd))
                score++;
            else
                issues.Add("No special characters");

            // Repeated characters
            if (ContainsRepeat(pwd))
                issues.Add("Password contains repeated characters");

            Console.WriteLine($"\nPassword Score: {score}/5");

            if (score == 5)
                Console.WriteLine("Password is Strong");
            else
                Console.WriteLine("Password is Weak");

            Console.WriteLine("\nIssues Found:");
            foreach (string issue in issues)
                Console.WriteLine("- " + issue);
        }

        // Here StringBuilder is used to Generate password 
        protected void GeneratePassword()
        {
            List<char> upper = new List<char>("ABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray());
            List<char> lower = new List<char>("abcdefghijklmnopqrstuvwxyz".ToCharArray());
            List<char> digits = new List<char>("0123456789".ToCharArray());
            List<char> special = new List<char>("!@#$%^&*()_+-=?".ToCharArray());
            StringBuilder pass = new StringBuilder();
            Random r = new Random();

            pass.Append(upper[r.Next(upper.Count)]);
            pass.Append(lower[r.Next(lower.Count)]);
            pass.Append(digits[r.Next(digits.Count)]);
            pass.Append(special[r.Next(special.Count)]);
            //creating a new list to make password to reach minimum length 8
            List<char> fullfill = new List<char>();
            fullfill.AddRange(upper);
            fullfill.AddRange(lower);
            fullfill.AddRange(digits);
            fullfill.AddRange(special);
            for (int i = 4; i < 8; i++)
            { 
                pass.Append(fullfill[r.Next(fullfill.Count)]);
            }
            Console.WriteLine("Your New Password is Generated Succesfully!!!");
            Console.WriteLine("Suggested Password is " + pass.ToString());
        }
    }

    class Program : Password
    {
        static void Main(string[] args)
        {
            Program p = new Program();
            int choice;
            while (true)
            {
                Console.WriteLine("\n=== Password Manager ===");
                Console.WriteLine("1. Analyze Password");
                Console.WriteLine("2.Suggest Strong Password");
                Console.WriteLine("3. Exit");
                Console.Write("Choose Option: ");
                if (!int.TryParse(Console.ReadLine(), out choice))
                {
                    Console.WriteLine("Enter numbers only!");
                    continue;
                }

                if (choice == 1)
                {
                    p.PasswordAnalyzer();
                }
                else if (choice == 2)
                {
                    p.GeneratePassword();
                }
                else if (choice == 3)
                {
                    break;
                }
                else
                {
                    Console.WriteLine("Please Enter Valid Choice !!");
                }
            }
        }
    }
}
